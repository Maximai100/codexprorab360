# ๐ ะะพะปะฝะพะต ะพัะปะฐะดะพัะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะดะพะฑะฐะฒะปะตะฝะพ

## ๐ ะะฑะทะพั

ะ ะฟัะธะปะพะถะตะฝะธะต ะดะพะฑะฐะฒะปะตะฝะพ **ะผะฐะบัะธะผะฐะปัะฝะพ ะฟะพะดัะพะฑะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต** ะดะปั ะดะธะฐะณะฝะพััะธะบะธ ะฟัะพะฑะปะตะผ ั ัะฒะตะดะพะผะปะตะฝะธัะผะธ. ะะฐะถะดัะน ัะฐะณ ะฟัะพัะตััะฐ ัะพะทะดะฐะฝะธั ะทะฐะฟะธัะธ ะธ ะพัะฟัะฐะฒะบะธ ัะฒะตะดะพะผะปะตะฝะธะน ัะตะฟะตัั ะปะพะณะธััะตััั ะฒ ะบะพะฝัะพะปั ะฑัะฐัะทะตัะฐ.

---

## ๐ ะะพะดะธัะธัะธัะพะฒะฐะฝะฝัะต ัะฐะนะปั

### 1. `index.tsx`

#### ะคัะฝะบัะธั `handleBookAppointment` (ัะพะทะดะฐะฝะธะต ะทะฐะฟะธัะธ ะฒ Directus)
**ะกััะพะบะธ: ~2389-2620**

ะะพะณะธััะตั 11 ัะฐะณะพะฒ:
- **ะจะะ A1**: ะะพะปััะตะฝะธะต ะดะฐะฝะฝัั ะดะปั ะทะฐะฟะธัะธ
- **ะจะะ A2**: ะะฟัะตะดะตะปะตะฝะธะต ID ะผะฐััะตัะฐ ะฒ ะะ (ั ะดะตัะฐะปัะฝัะผะธ ะทะฐะฟัะพัะฐะผะธ)
- **ะจะะ A3**: ะะพะธัะบ ID ััะปัะณะธ
- **ะจะะ A4**: ะคะพัะผะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั ะดะปั Directus โ๏ธ **ะะะะฎะงะะะข `status: 'confirmed'`**
- **ะจะะ A5**: POST ะทะฐะฟัะพั ะฒ Directus `/items/appointments`
- **ะจะะ A6**: ะะพะฝะฒะตััะฐัะธั ะดะฐะฝะฝัั ะธะท Directus ะฒ ะปะพะบะฐะปัะฝัะน ัะพัะผะฐั
- **ะจะะ A7**: ะะฑะฝะพะฒะปะตะฝะธะต ัะพััะพัะฝะธั appointments
- **ะจะะ A8**: ะะพัะผะฐะปะธะทะฐัะธั ID ะทะฐะฟะธัะธ
- **ะจะะ A9**: ะคะพัะผะธัะพะฒะฐะฝะธะต ะพะฑัะตะบัะฐ BookingInfo
- **ะจะะ A10**: ะคะธะฝะฐะปะธะทะฐัะธั (toast, haptic)
- **ะจะะ A11**: ะะพะทะฒัะฐั ัะพะทะดะฐะฝะฝะพะน ะทะฐะฟะธัะธ

#### ะคัะฝะบัะธั `handleBook` (ะพัะฟัะฐะฒะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน)
**ะกััะพะบะธ: ~680-820**

ะะพะณะธััะตั 10 ัะฐะณะพะฒ:
- **ะจะะ 1**: ะะฐัะฐะปะพ ะฟัะพัะตััะฐ, ะฟะพะปััะตะฝะธะต ะดะฐะฝะฝัั
- **ะจะะ 2**: ะะพะปััะตะฝะธะต ะธ ะฒะฐะปะธะดะฐัะธั ID ะผะฐััะตัะฐ (chat_id)
- **ะจะะ 3**: ะะพะปััะตะฝะธะต telegramId ะบะปะธะตะฝัะฐ
- **ะจะะ 4**: ะะฐะปะธะดะฐัะธั ัะพัะผะฐัะพะฒ ะดะฐัั ะธ ะฒัะตะผะตะฝะธ
- **ะจะะ 5**: ะะพะดะณะพัะพะฒะบะฐ ะดะฐะฝะฝัั ะดะปั Directus
- **ะจะะ 6**: ะัะทะพะฒ `onBookAppointment` (ัะพะทะดะฐะฝะธะต ะทะฐะฟะธัะธ)
- **ะจะะ 7**: ะะพะดะณะพัะพะฒะบะฐ payload ะดะปั ัะฒะตะดะพะผะปะตะฝะธั
- **ะจะะ 8**: ๐ **ะะขะะะะะะ ะฃะะะะะะะะะะฏ** ัะตัะตะท `sendBookingNotifications`
  - ะะพะณะธััะตั URL ัะฝะดะฟะพะธะฝัะฐ
  - ะะตัะฐะปัะฝะพ ะปะพะณะธััะตั ะบะฐะถะดะพะต ะฟะพะปะต payload
  - ะะพะณะธััะตั ัะตะทัะปััะฐั ะธะปะธ ะดะตัะฐะปัะฝัั ะพัะธะฑะบั
- **ะจะะ 9**: ะคะธะฝะฐะปะธะทะฐัะธั UI
- **ะจะะ 10**: ะะฐะฒะตััะตะฝะธะต ะฟัะพัะตััะฐ

### 2. `src/api/notify.ts`

#### ะคัะฝะบัะธั `sendBookingNotifications`
**ะฃัะธะปะตะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต:**

**ะะตัะตะด ะพัะฟัะฐะฒะบะพะน:**
- ๐ ะะฐัะฐะปะพ ะพัะฟัะฐะฒะบะธ ัะฒะตะดะพะผะปะตะฝะธั
- ๐ URL ัะฝะดะฟะพะธะฝัะฐ
- ๐ฆ ะะพะปะฝัะน payload (JSON ั ะพััััะฟะฐะผะธ)
- ๐ฆ ะะตัะฐะปะธ ะบะฐะถะดะพะณะพ ะฟะพะปั payload

**ะะพ ะฒัะตะผั ะพัะฟัะฐะฒะบะธ:**
- ๐ ะะพะผะตะฝั ะพัะฟัะฐะฒะบะธ fetch ะทะฐะฟัะพัะฐ
- ๐ ะขะตะปะพ ะทะฐะฟัะพัะฐ (ัััะพะบะฐ)

**ะะพัะปะต ะฟะพะปััะตะฝะธั ะพัะฒะตัะฐ:**
- ๐ฅ ะะพะปััะตะฝ ะพัะฒะตั
- ๐ HTTP ััะฐััั (ะบะพะด ะธ ัะตะบัั)
- ๐ Response OK (true/false)
- ๐ Response headers
- ๐ ะขะตะปะพ ะพัะฒะตัะฐ (ัะตะบัั)
- โ ะะฐัะฟะฐััะตะฝะฝัะน JSON

**ะัะธ ะพัะธะฑะบะฐั:**
- โ ะขะธะฟ ะพัะธะฑะบะธ
- ๐ด ะกะพะพะฑัะตะฝะธะต ะพัะธะฑะบะธ
- ๐ด Stack trace
- ๐ด ะะพะปะฝัะน ะพะฑัะตะบั ะพัะธะฑะบะธ
- โฑ๏ธ ะกะฟะตัะธะฐะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ัะฐะนะผะฐััะพะฒ
- ๐ ะกะฟะตัะธะฐะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ัะตัะตะฒัั ะพัะธะฑะพะบ

---

## ๐ ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั ะดะปั ะดะธะฐะณะฝะพััะธะบะธ

### ะจะฐะณ 1: ะัะบัะพะนัะต ะบะพะฝัะพะปั ะฑัะฐัะทะตัะฐ
- **Chrome/Edge**: F12 โ ะฒะบะปะฐะดะบะฐ Console
- **Firefox**: F12 โ ะฒะบะปะฐะดะบะฐ ะะพะฝัะพะปั
- **Safari**: Cmd+Option+C

### ะจะฐะณ 2: ะกะพะทะดะฐะนัะต ะทะฐะฟะธัั
1. ะัะบัะพะนัะต ะฟัะธะปะพะถะตะฝะธะต ะฒ Telegram
2. ะัะฑะตัะธัะต ััะปัะณั
3. ะะฐะฟะพะปะฝะธัะต ัะพัะผั ะทะฐะฟะธัะธ
4. ะะฐะถะผะธัะต "ะะฐะฟะธัะฐัััั"

### ะจะฐะณ 3: ะะฝะฐะปะธะทะธััะนัะต ะปะพะณะธ

#### โ ะฃัะฟะตัะฝัะน ััะตะฝะฐัะธะน ะดะพะปะถะตะฝ ะฟะพะบะฐะทะฐัั:
```
================================================================================
--- ะจะะ 1: ะะฐัะฐะปะพ ะฟัะพัะตััะฐ ัะพะทะดะฐะฝะธั ะทะฐะฟะธัะธ (handleBook) ---
...
--- ะจะะ 6: ะัะทะพะฒ onBookAppointment (ัะพะทะดะฐะฝะธะต ะทะฐะฟะธัะธ ะฒ Directus) ---
********************************************************************************
*** ะะฅะะ ะ handleBookAppointment (ัะพะทะดะฐะฝะธะต ะทะฐะฟะธัะธ ะฒ Directus) ***
********************************************************************************
...
--- ะจะะ A4: ะคะพัะผะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั ะดะปั Directus API ---
โ๏ธ ะะะะะะะะ: ะะพะฑะฐะฒะปะตะฝะพ ะฟะพะปะต status: "confirmed"
...
--- ะจะะ A5: ะัะฟัะฐะฒะบะฐ POST ะทะฐะฟัะพัะฐ ะฒ Directus ะดะปั ัะพะทะดะฐะฝะธั ะทะฐะฟะธัะธ ---
โ ะฃะกะะะฅ! ะะฐะฟะธัั ัะพะทะดะฐะฝะฐ ะฒ Directus
...
--- ะจะะ 8: ะัะฟัะฐะฒะบะฐ ัะฒะตะดะพะผะปะตะฝะธั ัะตัะตะท sendBookingNotifications ---
๐ ะะขะะะะะะ ะะะะะะกะ ะะ /notify...
๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐
๐ค ะะะงะะะ ะะขะะะะะะ ะฃะะะะะะะะะะฏ
...
โ ะฃะะะะะะะะะะ ะฃะกะะะจะะ ะะขะะะะะะะะ!
```

#### โ ะัะปะธ ัะฒะตะดะพะผะปะตะฝะธะต ะะ ะพัะฟัะฐะฒะปัะตััั, ะธัะธัะต:

**ะัะพะฑะปะตะผะฐ 1: ะะฐะฟัะพั ะฝะต ะดะพัะพะดะธั ะดะพ ะจะะ 8**
- ะัะพะฒะตัััะต, ะฝะฐ ะบะฐะบะพะผ ัะฐะณะต ะฟัะพะธััะพะดะธั ะพัะธะฑะบะฐ
- ะัะธัะต ัะพะพะฑัะตะฝะธั ั โ ะะะะขะะงะะกะะะฏ ะะจะะะะ

**ะัะพะฑะปะตะผะฐ 2: ะัะธะฑะบะฐ ะฒ Directus (ะจะะ A5)**
- ะัะพะฒะตัััะต, ะตััั ะปะธ ะฟะพะปะต `status: 'confirmed'` ะฒ ะปะพะณะฐั
- ะัะพะฒะตัััะต ะพัะฒะตั ัะตัะฒะตัะฐ Directus
- ะะพะทะผะพะถะฝะพ, ะฟะพะปะต `status` ะพััััััะฒัะตั ะฒ ััะตะผะต ะะ

**ะัะพะฑะปะตะผะฐ 3: ะัะธะฑะบะฐ ะฟัะธ ะพัะฟัะฐะฒะบะต ัะฒะตะดะพะผะปะตะฝะธั (ะจะะ 8)**
- ะัะพะฒะตัััะต URL ัะฝะดะฟะพะธะฝัะฐ (ะดะพะปะถะตะฝ ะฑััั `/notify`)
- ะัะพะฒะตัััะต payload (ะฒัะต ะปะธ ะฟะพะปั ะทะฐะฟะพะปะฝะตะฝั)
- ะัะพะฒะตัััะต HTTP ััะฐััั ะพัะฒะตัะฐ
- ะัะพะฒะตัััะต ัะพะพะฑัะตะฝะธะต ะพะฑ ะพัะธะฑะบะต ะพั ัะตัะฒะตัะฐ

**ะัะพะฑะปะตะผะฐ 4: ะขะฐะนะผะฐัั**
```
โฑ๏ธ ะขะะะะะฃะข! ะะฐะฟัะพั ะฟัะตะฒััะธะป 10 ัะตะบัะฝะด
```
- ะกะตัะฒะตั ัะฒะตะดะพะผะปะตะฝะธะน ะฝะต ะพัะฒะตัะฐะตั
- ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั ัะตัะฒะตัะฐ

**ะัะพะฑะปะตะผะฐ 5: ะกะตัะตะฒะฐั ะพัะธะฑะบะฐ**
```
๐ ะัะธัะธะฝะฐ: ะัะพะฑะปะตะผะฐ ั ัะตััั ะธะปะธ CORS
```
- CORS ะฝะต ะฝะฐัััะพะตะฝ ะฝะฐ ัะตัะฒะตัะต
- ะกะตัะฒะตั ะฝะตะดะพัััะฟะตะฝ
- ะัะพะฑะปะตะผั ั ัะตััั

---

## ๐ ะงะฐัััะต ะฟัะพะฑะปะตะผั ะธ ัะตัะตะฝะธั

### 1. ะััััััะฒัะตั ะฟะพะปะต `status` ะฒ Directus
**ะกะธะผะฟัะพะผ:** ะัะธะฑะบะฐ ะฝะฐ ะจะะ A5 ะฟัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะฟะธัะธ

**ะะตัะตะฝะธะต:** ะะพะฑะฐะฒััะต ะฟะพะปะต `status` ะฒ ะบะพะปะปะตะบัะธั `appointments` ะฒ Directus:
- ะขะธะฟ: String
- ะะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั: `confirmed`

### 2. ะะตะฟัะฐะฒะธะปัะฝัะน URL ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน
**ะกะธะผะฟัะพะผ:** ะัะธะฑะบะฐ 404 ะธะปะธ ัะตัะตะฒะฐั ะพัะธะฑะบะฐ ะฝะฐ ะจะะ 8

**ะะตัะตะฝะธะต:** ะัะพะฒะตัััะต ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั `VITE_BACKEND_URL` ะธะปะธ ะบะพะฝััะฐะฝัั `backendApiBaseUrl`

### 3. ะะตะบะพััะตะบัะฝัะน payload
**ะกะธะผะฟัะพะผ:** ะกะตัะฒะตั ะฒะพะทะฒัะฐัะฐะตั ะพัะธะฑะบั ะฒะฐะปะธะดะฐัะธะธ

**ะะตัะตะฝะธะต:** ะัะพะฒะตัััะต ะปะพะณะธ ะจะะ 7 ะธ ัะฑะตะดะธัะตัั, ััะพ ะฒัะต ะฟะพะปั ะทะฐะฟะพะปะฝะตะฝั ะบะพััะตะบัะฝะพ

### 4. CORS ะพัะธะฑะบะฐ
**ะกะธะผะฟัะพะผ:** ะัะธะฑะบะฐ `CORS policy` ะฒ ะบะพะฝัะพะปะธ

**ะะตัะตะฝะธะต:** ะะฐัััะพะนัะต CORS ะฝะฐ ะฑัะบะตะฝะดะต ะดะปั ะดะพะผะตะฝะฐ ะฟัะธะปะพะถะตะฝะธั

---

## ๐ ะัะธะผะตั ะฟะพะปะฝะพะณะพ ะปะพะณะฐ ััะฟะตัะฝะพะน ะทะฐะฟะธัะธ

```javascript
================================================================================
--- ะจะะ 1: ะะฐัะฐะปะพ ะฟัะพัะตััะฐ ัะพะทะดะฐะฝะธั ะทะฐะฟะธัะธ (handleBook) ---
ะะพะปััะตะฝะฝัะต ะดะฐะฝะฝัะต ะดะปั ะทะฐะฟะธัะธ: {clientName: "ะะฒะฐะฝ", clientPhone: "+79001234567", ...}
--- ะจะะ 2: ะะพะปััะตะฝะธะต ะธ ะฒะฐะปะธะดะฐัะธั ID ะผะฐััะตัะฐ ---
masterTelegramId ะธะท ัะพััะพัะฝะธั: 123456789
โ ะจะะ 2 ะฃะกะะะจะะ: masterId ะฒะฐะปะธะดะตะฝ
--- ะจะะ 3: ะะพะปััะตะฝะธะต telegramId ะบะปะธะตะฝัะฐ ---
clientTelegramId: 987654321
--- ะจะะ 4: ะะฐะปะธะดะฐัะธั ัะพัะผะฐัะพะฒ ะดะฐัั ะธ ะฒัะตะผะตะฝะธ ---
โ ะคะพัะผะฐั ะดะฐัั ะฒะฐะปะธะดะตะฝ: 2025-10-25
โ ะคะพัะผะฐั ะฒัะตะผะตะฝะธ ะฒะฐะปะธะดะตะฝ: 14:00
--- ะจะะ 5: ะะพะดะณะพัะพะฒะบะฐ ะดะฐะฝะฝัั ะดะปั ัะพะทะดะฐะฝะธั ะทะฐะฟะธัะธ ะฒ Directus ---
--- ะจะะ 6: ะัะทะพะฒ onBookAppointment (ัะพะทะดะฐะฝะธะต ะทะฐะฟะธัะธ ะฒ Directus) ---
********************************************************************************
*** ะะฅะะ ะ handleBookAppointment (ัะพะทะดะฐะฝะธะต ะทะฐะฟะธัะธ ะฒ Directus) ***
--- ะจะะ A4: ะคะพัะผะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั ะดะปั Directus API ---
โ๏ธ ะะะะะะะะ: ะะพะฑะฐะฒะปะตะฝะพ ะฟะพะปะต status: "confirmed"
--- ะจะะ A5: ะัะฟัะฐะฒะบะฐ POST ะทะฐะฟัะพัะฐ ะฒ Directus ะดะปั ัะพะทะดะฐะฝะธั ะทะฐะฟะธัะธ ---
โ ะฃะกะะะฅ! ะะฐะฟะธัั ัะพะทะดะฐะฝะฐ ะฒ Directus
*** ะะซะฅะะ ะะ handleBookAppointment - ะฃะกะะะจะะ ***
--- ะจะะ 7: ะะพะดะณะพัะพะฒะบะฐ ะดะฐะฝะฝัั ะดะปั ะพัะฟัะฐะฒะบะธ ัะฒะตะดะพะผะปะตะฝะธั ---
--- ะจะะ 8: ะัะฟัะฐะฒะบะฐ ัะฒะตะดะพะผะปะตะฝะธั ัะตัะตะท sendBookingNotifications ---
๐ ะะขะะะะะะ ะะะะะะกะ ะะ /notify...
๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐๐
๐ค ะะะงะะะ ะะขะะะะะะ ะฃะะะะะะะะะะฏ
๐ URL ัะฝะดะฟะพะธะฝัะฐ: https://api.prorab360.online/notify
๐ฆ ะะพะปะฝัะน payload: {
  "masterId": 123456789,
  "telegramId": 987654321,
  "clientName": "ะะฒะฐะฝ",
  "service": "ะกััะธะถะบะฐ",
  "date": "2025-10-25",
  "time": "14:00",
  "notificationType": "booking"
}
๐ ะัะฟัะฐะฒะบะฐ fetch ะทะฐะฟัะพัะฐ...
๐ฅ ะะพะปััะตะฝ ะพัะฒะตั ะพั ัะตัะฒะตัะฐ!
๐ HTTP ััะฐััั: 200
โ ะฃะะะะะะะะะะ ะฃะกะะะจะะ ะะขะะะะะะะะ!
--- ะจะะ 9: ะคะธะฝะฐะปะธะทะฐัะธั (haptic feedback, toast, UI ะพะฑะฝะพะฒะปะตะฝะธะต) ---
--- ะจะะ 10: ะัะพัะตัั ัะพะทะดะฐะฝะธั ะทะฐะฟะธัะธ ะะะะะะกะขะฌะฎ ะะะะะะจะะ ะฃะกะะะจะะ ---
================================================================================
```

---

## ๐ฏ ะกะปะตะดัััะธะต ัะฐะณะธ

1. **ะัะบัะพะนัะต ะบะพะฝัะพะปั ะฑัะฐัะทะตัะฐ** (F12)
2. **ะกะพะทะดะฐะนัะต ัะตััะพะฒัั ะทะฐะฟะธัั**
3. **ะกะบะพะฟะธััะนัะต ะฒัะต ะปะพะณะธ** ะธะท ะบะพะฝัะพะปะธ
4. **ะะฐะนะดะธัะต ะผะตััะพ ัะฑะพั** (ะฟะพัะปะตะดะฝะธะน ััะฟะตัะฝัะน ัะฐะณ ะฟะตัะตะด ะพัะธะฑะบะพะน)
5. **ะัะพะฐะฝะฐะปะธะทะธััะนัะต ะพัะธะฑะบั** ะธัะฟะพะปัะทัั ะธะฝัะพัะผะฐัะธั ะฒััะต

ะฃะดะฐัะธ ะฒ ะพัะปะฐะดะบะต! ๐
