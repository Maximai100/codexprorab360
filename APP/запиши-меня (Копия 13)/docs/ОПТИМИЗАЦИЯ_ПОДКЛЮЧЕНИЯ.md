# Оптимизация подключения к серверу

## Что было сделано

### 1. Добавлены таймауты для всех запросов
- **API Directus**: 10 секунд таймаут для всех запросов
- **Уведомления**: 10 секунд таймаут
- **Статус подписки**: 8 секунд таймаут

### 2. Улучшена обработка ошибок
- Понятные сообщения при превышении времени ожидания
- Автоматическая отмена зависших запросов
- Корректная очистка таймеров

### 3. Оптимизация axios
```typescript
const directusApi = axios.create({
  baseURL: API_URL,
  timeout: 10000, // 10 секунд
  headers: {
    'Content-Type': 'application/json',
  },
});
```

### 4. Оптимизация fetch запросов
```typescript
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 10000);

const response = await fetch(url, {
  signal: controller.signal,
  // ...
});
```

## Дополнительные рекомендации

### 1. Кэширование данных
Добавьте кэширование для часто запрашиваемых данных:
- Список услуг
- Расписание мастера
- Профиль мастера

### 2. Retry логика
Для критичных запросов можно добавить повторные попытки:
```typescript
async function fetchWithRetry(url, options, retries = 3) {
  for (let i = 0; i < retries; i++) {
    try {
      return await fetch(url, options);
    } catch (error) {
      if (i === retries - 1) throw error;
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
}
```

### 3. Индикатор загрузки
Показывайте пользователю, что идет загрузка:
- Спиннер при авторизации
- Скелетон для списка услуг
- Прогресс-бар для длительных операций

### 4. Оптимизация на стороне сервера
- Убедитесь, что сервер отвечает быстро (< 2 секунд)
- Используйте CDN для статических ресурсов
- Оптимизируйте запросы к базе данных
- Добавьте индексы в Directus

### 5. Проверка соединения
Можно добавить проверку доступности сервера перед основными запросами:
```typescript
async function checkServerHealth() {
  try {
    const response = await fetch(`${API_URL}/server/health`, {
      method: 'GET',
      signal: AbortSignal.timeout(3000),
    });
    return response.ok;
  } catch {
    return false;
  }
}
```

## Тестирование

Проверьте работу при медленном соединении:
1. Откройте DevTools → Network
2. Выберите "Slow 3G" или "Fast 3G"
3. Проверьте, что таймауты срабатывают корректно
4. Убедитесь, что пользователь видит понятные сообщения об ошибках

## Мониторинг

Добавьте логирование времени выполнения запросов:
```typescript
const startTime = Date.now();
// ... запрос
const duration = Date.now() - startTime;
console.log(`Запрос выполнен за ${duration}мс`);
```

Это поможет выявить узкие места в производительности.
