<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="theme-color" content="#3390ec">
    
    <!-- Prevent caching for development -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>–ü—Ä–æ—Ä–∞–±360</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize Telegram Web App
        if (window.Telegram && window.Telegram.WebApp) {
            const tg = window.Telegram.WebApp;
            
            // Enable closing confirmation
            tg.enableClosingConfirmation();
            
            // Set viewport height for mobile browsers
            const setViewportHeight = () => {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            };
            
            setViewportHeight();
            window.addEventListener('resize', setViewportHeight);
            
            // Pull-to-refresh –æ—Ç–∫–ª—é—á–µ–Ω –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            
            // Initialize the app
            tg.ready();
        } else {
            // Fallback for non-Telegram browsers
            console.log('Telegram WebApp not available, using fallback');
            
            // Set viewport height for mobile browsers
            const setViewportHeight = () => {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            };
            
            setViewportHeight();
            window.addEventListener('resize', setViewportHeight);
            
            // Pull-to-refresh –æ—Ç–∫–ª—é—á–µ–Ω –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        }
    });
    </script>

</head>
<body>
    <div id="root"></div>
    <script>
      // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–∞
      console.log('üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–∞:');
      console.log('- document.body.style.position:', document.body.style.position);
      console.log('- document.body.style.overflow:', document.body.style.overflow);
      console.log('- document.body.style.height:', document.body.style.height);
      console.log('- window.innerHeight:', window.innerHeight);
      console.log('- document.documentElement.scrollHeight:', document.documentElement.scrollHeight);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–∫—Ä–æ–ª–ª
      setTimeout(() => {
        const hasScroll = document.documentElement.scrollHeight > window.innerHeight;
        console.log('üìè –ï—Å—Ç—å –ª–∏ —Å–∫—Ä–æ–ª–ª:', hasScroll);
        console.log('üìè –í—ã—Å–æ—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞:', document.documentElement.scrollHeight);
        console.log('üìè –í—ã—Å–æ—Ç–∞ –æ–∫–Ω–∞:', window.innerHeight);
      }, 1000);

      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/sw.js').then(function(registration) {
            console.log('SW registered successfully');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            registration.update();
            
            // –°–ª—É—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Service Worker
            registration.addEventListener('updatefound', function() {
              console.log('SW: New version found, updating...');
              const newWorker = registration.installing;
              
              newWorker.addEventListener('statechange', function() {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  console.log('SW: New version installed, reloading...');
                  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
                  window.location.reload();
                }
              });
            });
            
            // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Service Worker
            navigator.serviceWorker.addEventListener('message', function(event) {
              if (event.data.type === 'UPDATE_AVAILABLE') {
                console.log('SW: Update available, reloading...');
                window.location.reload();
              }
            });
            
          }).catch(function(err){
            console.warn('SW registration failed', err);
          });
          
          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç–∫–ª—é—á–µ–Ω–∞
          // –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        });
      }
    </script>
    <script type="module" src="src/index.tsx"></script>
</body>
</html>