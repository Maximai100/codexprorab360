<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="theme-color" content="#3390ec">
    
    <!-- Prevent caching for development -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>–°–º–µ—Ç–∞ –∑–∞ 5 –º–∏–Ω—É—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // Initialize Telegram Web App
        if (window.Telegram && window.Telegram.WebApp) {
            const tg = window.Telegram.WebApp;
            
            // Enable closing confirmation
            tg.enableClosingConfirmation();
            
            // Set viewport height for mobile browsers
            const setViewportHeight = () => {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            };
            
            setViewportHeight();
            window.addEventListener('resize', setViewportHeight);
            
            // Pull-to-refresh functionality
            let startY = 0;
            let currentY = 0;
            let isPulling = false;
            let pullDistance = 0;
            const PULL_THRESHOLD = 100; // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            const MAX_PULL = 150; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
            
            // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            const refreshIndicator = document.createElement('div');
            refreshIndicator.id = 'refresh-indicator';
            refreshIndicator.innerHTML = '‚Üì –ü–æ—Ç—è–Ω–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è';
            refreshIndicator.style.cssText = `
                position: fixed;
                top: -50px;
                left: 0;
                right: 0;
                height: 50px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 14px;
                font-weight: 500;
                transition: transform 0.3s ease;
                z-index: 1000;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            `;
            document.body.appendChild(refreshIndicator);
            
            document.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
                isPulling = false;
                pullDistance = 0;
            }, { passive: true });
            
            document.addEventListener('touchmove', (e) => {
                currentY = e.touches[0].clientY;
                const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –º—ã –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                if (scrollTop <= 0 && currentY > startY) {
                    pullDistance = currentY - startY;
                    
                    if (pullDistance > 20) {
                        isPulling = true;
                        e.preventDefault();
                        
                        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
                        const limitedDistance = Math.min(pullDistance, MAX_PULL);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
                        if (limitedDistance >= PULL_THRESHOLD) {
                            refreshIndicator.innerHTML = '‚Üë –û—Ç–ø—É—Å—Ç–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è';
                            refreshIndicator.style.background = 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)';
                        } else {
                            refreshIndicator.innerHTML = '‚Üì –ü–æ—Ç—è–Ω–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è';
                            refreshIndicator.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                        }
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                        refreshIndicator.style.transform = `translateY(${limitedDistance}px)`;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                        document.body.style.transform = `translateY(${limitedDistance * 0.3}px)`;
                        document.body.style.transition = 'none';
                    }
                }
            }, { passive: false });
            
            document.addEventListener('touchend', (e) => {
                if (isPulling && pullDistance >= PULL_THRESHOLD) {
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                    refreshIndicator.innerHTML = 'üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...';
                    refreshIndicator.style.background = 'linear-gradient(135deg, #FF9800 0%, #F57C00 100%)';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    setTimeout(() => {
                        window.location.reload();
                    }, 500);
                } else {
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
                    refreshIndicator.style.transform = 'translateY(-50px)';
                    document.body.style.transform = 'translateY(0)';
                    document.body.style.transition = 'transform 0.3s ease';
                    
                    setTimeout(() => {
                        refreshIndicator.style.transform = 'translateY(-50px)';
                        refreshIndicator.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                        refreshIndicator.innerHTML = '‚Üì –ü–æ—Ç—è–Ω–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è';
                    }, 300);
                }
                
                isPulling = false;
                pullDistance = 0;
            }, { passive: true });
            
            // Initialize the app
            tg.ready();
        } else {
            // Fallback for non-Telegram browsers
            console.log('Telegram WebApp not available, using fallback');
            
            // Set viewport height for mobile browsers
            const setViewportHeight = () => {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            };
            
            setViewportHeight();
            window.addEventListener('resize', setViewportHeight);
            
            // Pull-to-refresh functionality for regular browsers
            let startY = 0;
            let currentY = 0;
            let isPulling = false;
            let pullDistance = 0;
            const PULL_THRESHOLD = 100;
            const MAX_PULL = 150;
            
            // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            const refreshIndicator = document.createElement('div');
            refreshIndicator.id = 'refresh-indicator';
            refreshIndicator.innerHTML = '‚Üì –ü–æ—Ç—è–Ω–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è';
            refreshIndicator.style.cssText = `
                position: fixed;
                top: -50px;
                left: 0;
                right: 0;
                height: 50px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 14px;
                font-weight: 500;
                transition: transform 0.3s ease;
                z-index: 1000;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            `;
            document.body.appendChild(refreshIndicator);
            
           document.addEventListener('touchstart', (e) => {
               startY = e.touches[0].clientY;
               isPulling = false;
               pullDistance = 0;
           }, { passive: true });
           
           document.addEventListener('touchmove', (e) => {
               currentY = e.touches[0].clientY;
               const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
               
               // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ —Å–∞–º–æ–º –≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Ç—è–Ω–µ–º –≤–Ω–∏–∑
               if (scrollTop <= 5 && currentY > startY) {
                   pullDistance = currentY - startY;
                   
                   // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º pull-to-refresh —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏
                   if (pullDistance > 30) {
                       isPulling = true;
                       e.preventDefault();
                       
                       const limitedDistance = Math.min(pullDistance, MAX_PULL);
                       
                       if (limitedDistance >= PULL_THRESHOLD) {
                           refreshIndicator.innerHTML = '‚Üë –û—Ç–ø—É—Å—Ç–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è';
                           refreshIndicator.style.background = 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)';
                       } else {
                           refreshIndicator.innerHTML = '‚Üì –ü–æ—Ç—è–Ω–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è';
                           refreshIndicator.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                       }
                       
                       refreshIndicator.style.transform = `translateY(${limitedDistance}px)`;
                       document.body.style.transform = `translateY(${limitedDistance * 0.2}px)`;
                       document.body.style.transition = 'none';
                   }
               }
           }, { passive: false });
            
            document.addEventListener('touchend', (e) => {
                if (isPulling && pullDistance >= PULL_THRESHOLD) {
                    refreshIndicator.innerHTML = 'üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...';
                    refreshIndicator.style.background = 'linear-gradient(135deg, #FF9800 0%, #F57C00 100%)';
                    
                    setTimeout(() => {
                        window.location.reload();
                    }, 500);
                } else if (isPulling) {
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
                    refreshIndicator.style.transform = 'translateY(-50px)';
                    document.body.style.transform = 'translateY(0)';
                    document.body.style.transition = 'transform 0.3s ease';
                    
                    setTimeout(() => {
                        refreshIndicator.style.transform = 'translateY(-50px)';
                        refreshIndicator.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                        refreshIndicator.innerHTML = '‚Üì –ü–æ—Ç—è–Ω–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è';
                    }, 300);
                }
                
                isPulling = false;
                pullDistance = 0;
            }, { passive: true });
        }
    </script>

</head>
<body>
    <div id="root"></div>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/sw.js').then(function(registration) {
            console.log('SW registered successfully');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            registration.update();
            
            // –°–ª—É—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Service Worker
            registration.addEventListener('updatefound', function() {
              console.log('SW: New version found, updating...');
              const newWorker = registration.installing;
              
              newWorker.addEventListener('statechange', function() {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  console.log('SW: New version installed, reloading...');
                  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
                  window.location.reload();
                }
              });
            });
            
            // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Service Worker
            navigator.serviceWorker.addEventListener('message', function(event) {
              if (event.data.type === 'UPDATE_AVAILABLE') {
                console.log('SW: Update available, reloading...');
                window.location.reload();
              }
            });
            
          }).catch(function(err){
            console.warn('SW registration failed', err);
          });
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
          setInterval(function() {
            if (navigator.serviceWorker.controller) {
              navigator.serviceWorker.controller.postMessage({ type: 'CHECK_UPDATE' });
            }
          }, 30000);
        });
      }
    </script>
    <script type="module" src="src/index.tsx"></script>
</body>
</html>