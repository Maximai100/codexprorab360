# PDF Service - Документация

## Обзор

Реализован сервис для генерации PDF-документов в приложении. Сервис поддерживает создание двух типов документов:
- Сметы (Estimate PDF)
- Акты выполненных работ (Act PDF)

## Установленные библиотеки

- `jspdf` - основная библиотека для создания PDF
- `jspdf-autotable` - расширение для создания таблиц в PDF

## Структура файлов

```
src/services/PdfService.ts - основной сервис для генерации PDF
```

## Функциональность

### 1. Генерация сметы (generateEstimatePDF)

**Параметры:**
- `estimate: Estimate` - объект сметы
- `project: Project | null` - проект (опционально)
- `companyProfile: CompanyProfile` - профиль компании

**Возможности:**
- Шапка с логотипом и названием компании
- Заголовок "Смета № {номер}"
- Информация о клиенте и объекте
- Таблица позиций с колонками: №, Наименование, Кол-во, Ед. изм., Цена за ед., Сумма
- Расчет итогов: Подытог, Скидка, Налог, ИТОГО к оплате
- Подвал с местами для подписей

### 2. Генерация акта (generateActPDF)

**Параметры:**
- `project: Project` - объект проекта
- `workStages: WorkStage[]` - массив этапов работ
- `companyProfile: CompanyProfile` - профиль компании
- `totalAmount: number` - общая сумма

**Возможности:**
- Шапка с логотипом и названием компании
- Заголовок "Акт №... от ..."
- Информация о проекте
- Таблица выполненных этапов: №, Наименование этапа, Дата начала, Дата завершения
- Итоговая сумма работ
- Подвал с местами для подписей и печати

## Интеграция в UI

### EstimateView
- Кнопка "Экспорт в PDF" в нижней части экрана
- При нажатии вызывается `PdfService.generateEstimatePDF()`

### ProjectDetailView
- Кнопка "Сгенерировать акт" (видна только для завершенных проектов)
- Открывает модальное окно `ActGenerationModal`
- В модальном окне есть кнопка "Скачать PDF"

## Особенности реализации

### Поддержка кириллицы
- Используется встроенный шрифт Helvetica, который поддерживает кириллические символы
- Настройка шрифта через `doc.setFont('helvetica')`

### Форматирование
- Форматирование валюты через `Intl.NumberFormat` с русской локалью
- Форматирование дат через `toLocaleDateString('ru-RU')`

### Автоматическое именование файлов
- Сметы: `Смета_{номер}_{дата}.pdf`
- Акты: `Акт_{номер}_{дата}.pdf`

## Использование

### В коде
```typescript
import { PdfService } from './services/PdfService';

// Генерация сметы
await PdfService.generateEstimatePDF(estimate, project, companyProfile);

// Генерация акта
await PdfService.generateActPDF(project, workStages, companyProfile, totalAmount);
```

### В UI
1. **Для сметы:** Нажмите кнопку "Экспорт в PDF" в EstimateView
2. **Для акта:** Нажмите кнопку "Сгенерировать акт" в ProjectDetailView, затем "Скачать PDF" в модальном окне

## Обработка ошибок

Все ошибки генерации PDF логируются в консоль и показываются пользователю через `showAlert()`.

## Будущие улучшения

- Добавление логотипа компании в PDF
- Настройка цветовой схемы документов
- Поддержка дополнительных форматов документов
- Возможность настройки шаблонов документов
